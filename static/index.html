<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RPG Chat</title>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family:"Segoe UI", Tahoma, sans-serif;
  background: linear-gradient(135deg, #1e293b, #0f172a);
  display:flex; justify-content:center; align-items:center;
  height:100vh; color:#fff;
}
#chat {
  display:flex; flex-direction:column; width:95%; max-width:600px;
  height:90vh; background:#1e293b; border-radius:15px; overflow:hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
#messages { 
  flex:1; overflow-y:auto; padding:15px; font-size:15px; line-height:1.4; display:flex; flex-direction:column; 
}
.message {
  display:flex; margin:8px 0;
  animation:fadeIn 0.3s ease-in;
}
.message.server { justify-content:flex-start; }
.message.server p { 
  background:#3b82f6; 
  border-radius:20px 20px 20px 5px; 
  max-width:75%; 
  padding:10px 14px; 
  word-wrap:break-word; 
}
.message.user { justify-content:flex-end; }
.message.user p { 
  background:#22c55e; 
  border-radius:20px 20px 5px 20px; 
  max-width:75%; 
  padding:10px 14px; 
  word-wrap:break-word; 
}
#input-area { display:flex; padding:10px; border-top:1px solid #334155; background:#0f172a; }
#msg { flex:1; padding:12px 15px; border:none; border-radius:25px; font-size:15px; outline:none; background:#1e293b; color:#fff; }
#send, #clear { padding:12px 18px; margin-left:8px; border:none; border-radius:25px; background:#16a34a; color:white; font-weight:bold; cursor:pointer; transition:0.2s; }
#send:hover, #clear:hover { background:#15803d; }
@keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
</style>
</head>
<body>

<div id="chat">
  <div id="messages"></div>
  <div id="input-area">
    <input id="msg" type="text" placeholder="Digite sua mensagem..." autocomplete="off"/>
    <button id="send">Enviar</button>
    <button id="clear">Limpar histÃ³rico</button>
  </div>
</div>

<script>
let username = localStorage.getItem("username");
if (!username) {
  username = prompt("Digite seu nome de usuÃ¡rio:");
  localStorage.setItem("username", username);
}

// ðŸ”¹ EndereÃ§o do backend no Render
const backend = "https://rpgserver.onrender.com"; // troque se estiver em outro domÃ­nio
const socket = io(backend, { transports: ["websocket"] });

const messages = document.getElementById("messages");
const input = document.getElementById("msg");
const button = document.getElementById("send");
const clearBtn = document.getElementById("clear");

function addMessage(text, type="server") {
  const container = document.createElement("div");
  container.className = `message ${type}`;
  const p = document.createElement("p");
  p.textContent = text;
  container.appendChild(p);
  messages.appendChild(container);
  messages.scrollTop = messages.scrollHeight;
}

socket.on("connect", () => {
  addMessage("âœ… Conectado ao servidor!", "server");
  fetch(`${backend}/history`)
    .then(res => res.json())
    .then(msgs => {
      msgs.forEach(m => {
        const type = m.user === username ? "user" : "server";
        addMessage(`${m.user}: ${m.text}`, type);
      });
    });
});

socket.on("message", (data) => {
  if (!data.user || !data.text) return;
  if (data.user === username) return;
  addMessage(`${data.user}: ${data.text}`, "server");
});

socket.on("history_cleared", () => {
  messages.innerHTML = "";
  addMessage("ðŸ—‘ HistÃ³rico limpo!", "server");
});

function sendMessage() {
  const msg = input.value.trim();
  if (!msg) return;
  socket.send({ user: username, text: msg });
  addMessage(msg, "user");
  input.value = "";
}

button.addEventListener("click", sendMessage);
input.addEventListener("keypress", e => { if(e.key==="Enter") sendMessage(); });

clearBtn.addEventListener("click", () => {
  if (!confirm("Tem certeza que quer apagar todas as mensagens?")) return;
  fetch(`${backend}/clear_history`, { method: "POST" })
    .then(res => res.json())
    .then(data => {
      if (data.status === "ok") {
        messages.innerHTML = "";
        addMessage("ðŸ—‘ HistÃ³rico limpo!", "server");
      }
    });
});
</script>

</body>
</html>
